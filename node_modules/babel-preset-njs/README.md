A [Babel](https://babeljs.io)
[preset](https://babeljs.io/docs/en/presets) for transforming JavaScript
code with modern language features into code compatible with
[njs](https://github.com/nginx/njs) (NGINX JavaScript). This preset
includes support for all the ECMAScript features that TypeScript
supports ([Stage](https://tc39.es/process-document/) 3+) — see
[Plugins](#_plugins) for a complete list.

## Installation

``` sh
# using npm:
npm install --save-dev babel-preset-njs
# or using yarn:
yarn add --dev babel-preset-njs
```

## Usage

### With a Configuration File (Recommended)

``` json
{
  "presets": ["babel-preset-njs"]
}
```

``` json
{
  "presets": [
    ["babel-preset-njs", { "assumeArrayIterables": false }]
  ]
}
```

### Via CLI

``` sh
babel --presets babel-preset-njs script.js
```

### Via Node API

``` js
require('@babel/core').transform('code', {
  presets: [require('babel-preset-njs')],
})
```

## Options

### `assumeArrayIterables`

`boolean`, defaults to `true`

Assume that all iterables used in `for...of` loops, [array spread
syntax](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax#Spread_in_array_literals)
and [array
destructuring](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment#Array_destructuring)
are arrays. This produces more compact and significantly more performant
code, but it will fail in runtime if the iterable is not an array.

TypeScript transpiler uses the same approach for ES5 target when
`downlevelIteration` is disabled. It also indicates error when the
iterable is not an array.

It sets the following plugin options:

  - [for-of](https://babeljs.io/docs/en/babel-plugin-transform-for-of#assumearray):
    `assumeArray`

  - [spread](https://babeljs.io/docs/en/babel-plugin-transform-spread#loose):
    `loose`

  - [destructuring](https://babeljs.io/docs/en/babel-plugin-transform-destructuring#loose):
    `loose`

### `asyncHelpers`

`'external'`, `'local'`, `'inline'`

Toggles how
[async-to-promises](https://github.com/rpetrich/babel-plugin-transform-async-to-promises)
injects its helpers:

  - `'external'` — injects import from
    `babel-plugin-transform-async-to-promises/helpers` into each file
    with async/await

  - `'local'` — injects the needed helper functions into each file with
    async/await

  - `'inline'` — inlines the needed helper code in place of each
    occurrence of async/await

Defaults to `'external'` if Rollup or webpack is detected, otherwise
`'local'`.

  - [async-to-promises](https://github.com/rpetrich/babel-plugin-transform-async-to-promises):
    `externalHelpers`, `inlineHelpers`

### `looseClasses`

`boolean`, defaults to `true`

Define class methods and properties using a simple assignment expression
instead of `Object.defineProperty()`. This produces more compact and
performant code, but it might produce unexpected results in some
(corner) cases. TypeScript transpiler uses the same approach.

It sets the following plugin options:

  - [classes](https://babeljs.io/docs/en/babel-plugin-transform-classes#loose):
    `loose`

  - [class-properties](https://babeljs.io/docs/en/babel-plugin-proposal-class-properties#loose):
    `loose`

  - [private-property-in-object](https://babeljs.io/docs/en/babel-plugin-proposal-private-property-in-object#loose):
    `loose`

### `looseObjectRestSpread`

`boolean`, defaults to `true`

Transform [object rest/spread
properties](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax#Spread_in_object_literals)
using `Object.assign()` instead of Babel’s `objectSpread` helper. This
produces more compact and performant code, but it might produce
unexpected results in some (corner) cases (when overwriting read-only
target property). TypeScript transpiler uses the same approach.

It sets the following plugin options:

  - [object-rest-spread](https://babeljs.io/docs/en/babel-plugin-proposal-object-rest-spread#loose):
    `loose`

### `looseParameters`

`boolean`, defaults to `true`

In loose mode, function parameters with default values will be counted
into the arity of the function. This is not spec behaviour where these
parameters do not add to function arity, but it produces more compact
and performant code. TypeScript transpiler uses the same approach.

It sets the following plugin options:

  - [parameters](https://babeljs.io/docs/en/babel-plugin-transform-parameters#loose):
    `loose`

## Plugins

The list of included Babel plugins is available
[here](https://github.com/jirutka/babel-preset-njs/blob/v0.2.0/README.adoc#plugins).

## References

  - [njs ECMAScript
    Compatibility](http://nginx.org/en/docs/njs/compatibility.html)

## License

This project is licensed under [MIT
License](http://opensource.org/licenses/MIT/).
